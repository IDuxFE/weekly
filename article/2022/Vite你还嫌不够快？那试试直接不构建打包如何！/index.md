## èƒŒæ™¯

éšç€IEå·²ç»é€€å‡ºå†å²èˆå°ï¼Œä¸”ç›®å‰å¤§å¤šæ•°æµè§ˆå™¨éƒ½å†…ç½®äº†å¯¹ module çš„æ”¯æŒï¼Œå› æ­¤æ„å»ºæ¸æ¸æˆä¸ºäº†ä¸€ä¸ª**ä¼˜åŒ–æ­¥éª¤**è€Œä¸æ˜¯å¿…è¦æ­¥éª¤ ã€‚é‚£ä¹ˆï¼Œåˆè¡·æ˜¯ä¸ºäº†æ”¯æŒæŸäº›å¤è€ç‰ˆæœ¬æµè§ˆå™¨è¿è¡Œè€Œè¡ç”Ÿå‡ºæ¥çš„æ„å»ºæ­¥éª¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿ç•™å—ï¼ŸğŸ™ˆ

## å½“å‰å¼€å‘æµç¨‹ä¸­å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ

-  æ„å»ºæµç¨‹é•¿ï¼Œæˆæœ¬é«˜

ç›®å‰å‰ç«¯çš„æ„å»ºæ¶‰åŠåˆ°ä¸‹å›¾æ‰€ç¤ºçš„å¤šä¸ªæ­¥éª¤ï¼ˆ ä¾èµ–çš„æ‹‰å–ã€ä¾èµ–å›¾åˆ†æã€æ‰“åŒ…ä¾èµ–... ï¼‰ï¼Œå¦‚æœåœ¨æ•æ·å¼€å‘çš„åœºæ™¯ä¸‹ï¼Œreleaseåˆ†æ”¯éœ€è¦ç»å¸¸æ›´æ–°ï¼Œè¿™æ— ç–‘ä¼šé€ æˆæµæ°´çº¿çš„é˜»å¡ï¼›åŒæ—¶æ”¹åŠ¨å°‘æ•°ä»£ç å´å¯¼è‡´æ•´ä¸ªæ„å»ºæµç¨‹è¿›è¡Œï¼Œä¹Ÿé€ æˆäº†èµ„æºçš„æµªè´¹ã€‚![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/40f0e632e9094c35ad38df8d379cbc77~tplv-k3u1fbpfcp-zoom-1.image)


- ä¾èµ–åŒ…åŸºäºç‰ˆæœ¬å·è¿›è¡Œå‘å¸ƒæ›´æ–°ï¼Œæå…¶ç¼“æ…¢

å› ä¸ºä¾èµ–åŒ…ä¹‹é—´æ˜¯ä¸€ä¸ªå•å‘çš„ä¿¡æ¯æµï¼Œå¦‚ä¸‹å›¾ï¼šA dependenciesçš„æ›´æ–°æ˜¯ä¸ä¼šä¸»åŠ¨é€šçŸ¥UI Componentçš„ï¼›è€Œå¯¹äºå¤„äºæœ€ä¸Šå±‚çš„Web APPæ¥è¯´ï¼Œå¾€å¾€å°±ä¼šå› ä¸ºä¾èµ–åŒ…çš„æŸä¸€ç‚¹é˜»å¡ï¼Œä»è€Œå¯¼è‡´æ— æ³•å¿«é€Ÿæ›´æ–°ç‰ˆæœ¬ã€‚  
æˆ‘ä»¬ä¸å¦¨å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼šä¸€ä¸ªä¸šåŠ¡å¼€å‘è€…**å°æ˜**å‘ç°A dependenciesæœ‰æ— æ³•hackçš„bugï¼Œé‚£ä¹ˆä»–åªèƒ½ä¸æ–­åœ°å»å…³æ³¨A dependenciesçš„æ›´æ–°æƒ…å†µï¼Œè·å–æ›´æ–°ç‰ˆæœ¬åï¼Œè¿˜éœ€è¦ä¿®æ”¹package.jsonï¼Œä»¥ä¾¿è§¦å‘æ„å»ºè¿‡ç¨‹ï¼Œä¿®å¤è¿™ä¸ªbugã€‚å¦‚æœæ°å·§A dependenciesçš„ä¾èµ–åŒ…A-a dependenciesä¹Ÿå­˜åœ¨è¿™æ ·çš„bugå‘¢ï¼Ÿé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹çš„é˜»å¡æ—¶é—´å°†ä¼šæˆå€å¢é•¿ã€‚ ğŸ˜¹
   ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/910e6b6f92014eef8e239bcb9f0b3613~tplv-k3u1fbpfcp-zoom-1.image)

- æ„å»ºé…ç½®å¤æ‚ç¹ç

è™½ç„¶å„ç§æ„å»ºå·¥å…·ã€è„šæ‰‹æ¶é¢„è®¾é…ç½®å·²ç»å°½å¯èƒ½ç®€å•ï¼Œä½†æ˜¯å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œå®šåˆ¶åŒ–é…ç½®ä¸å¯ç¼ºå°‘ã€‚
webpackå› å…¶å¤æ‚æ€§ï¼Œç”šè‡³å‡ºç°äº†ä¸“é—¨çš„webpacké…ç½®å·¥ç¨‹å¸ˆï¼›viteè™½ç„¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰æ‰€ä¼˜åŒ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åˆ‡åº•è¿™ä¸ªé—®é¢˜ã€‚

## ä¸ºä»€ä¹ˆESMæœ‰æœ›è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ

```html
ESMï¼Œå³ECMA Script Modulesï¼Œç®€ä»‹ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules
```

å¦‚æœé¡¹ç›®ä½¿ç”¨äº†ESMï¼Œä¼šå‘ç”Ÿä»€ä¹ˆç¥å¥‡çš„äº‹æƒ…å‘¢ï¼Ÿè¿˜æ˜¯æ‹¿**å°æ˜**æ¥ä¸¾ä¾‹ï¼Œå½“A dependenciesçš„bugè¢«ä¿®å¤åï¼Œç”¨æˆ·ä¾§å°†é€šè¿‡importç›´æ¥åŠ è½½fixedåçš„ä»£ç ï¼Œå®Œå…¨ä¸éœ€è¦é‡æ–°è§¦å‘æ„å»ºï¼ˆå¦‚æœA dependenciesçš„æ¨¡å—æ‹†åˆ†åˆç†ï¼Œç”šè‡³åªéœ€è¦æ›´æ–°fixedå¯¹åº”çš„ä»£ç ï¼‰ï¼Œå³å¯å®Œæˆé¡¹ç›®çš„æ›´æ–°ã€‚

## Talk is cheapï¼Œshow me the codeï¼

æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨ESM+esinstallå®ç°ä¸€ä¸ªæ— æ„å»ºçš„Hello Worldã€‚ğŸ’¯

- è®¾ç½®index.html

æˆ‘ä»¬åœ¨scriptæ ‡ç­¾ä¸­å£°æ˜type="module"ï¼Œå¹¶å¼•å…¥ä¸»jsæ–‡ä»¶main.jsã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="module" src="../js/main.js"></script>
</head>
<body>
    <h1>Hello World</h1>
    <my-element></my-element>
</body>
</html>
```

- npm init

åƒæ™®é€šé¡¹ç›®ä¸€æ ·æ–°å»ºpackage.jsonï¼Œåˆ—å‡ºä¾èµ–é¡¹ã€‚


```json
{
  "name": "no-packaging",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "build": "node --experimental-modules build-modules.mjs",
    "postinstall": "yarn build"
  },
  "keywords": [
    "esinstall"
  ],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "dom-confetti": "^0.2.2",
    "lit": "^2.2.1"
  },
  "devDependencies": {
    "esinstall": "^1.1.7"
  }
}

```


- esinstallè®¾ç½®

```html
esinstallç®€ä»‹ï¼šhttps://www.npmjs.com/package/esinstall
```

å½“å‰æƒ…å†µï¼Œæ”¾å¼ƒnpmä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿæ˜¾ç„¶æ˜¯ä¸ç†æ™ºä¸”ä¸ç°å®çš„ã€‚å› æ­¤æˆ‘ä»¬é‡‡ç”¨esinstallæ¥å°†ä¾èµ–åŒ…è½¬æ¢ä¸ºESMã€‚

æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªbuildModulesé€‰é¡¹ï¼Œç”¨äºå£°æ˜æˆ‘ä»¬éœ€è¦è½¬æ¢ä¸ºESMçš„ä¾èµ–é¡¹ã€‚
å¹¶ä¸”åˆ›å»ºä¸€ä¸ª[postinstall](https://docs.npmjs.com/cli/v8/using-npm/scripts)è„šæœ¬ï¼Œåœ¨æ¯æ¬¡installåè‡ªåŠ¨è¿è¡Œï¼Œè¿™ä¸ªè„šæœ¬æ‰§è¡Œbuild-modules.mjsã€‚

```json
{
  "name": "no-packaging",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "build": "node --experimental-modules build-modules.mjs",
    "postinstall": "yarn build"
  },
  "keywords": [
    "esinstall"
  ],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "dom-confetti": "^0.2.2",
    "lit": "^2.2.1"
  },
  "devDependencies": {
    "esinstall": "^1.1.7"
  },
  "buildModules": {
    "install": [
      "lit",
      "dom-confetti"
    ],
    "installOptions": {
      "dest": "js/vendor"
    }
  }
}

```

è€Œbuild-modules.mjsæ‰€åšçš„å°±æ˜¯è¯»å–package.jsonä¸­éœ€è¦è½¬æ¢çš„ä¾èµ–åˆ—è¡¨ï¼Œå¹¶äº¤ç»™esinstallè¿›è¡Œè½¬æ¢ã€‚
```js
import { install } from 'esinstall';
import { readFile } from 'fs/promises';

const json = JSON.parse(
  await readFile(
    new URL('./package.json', import.meta.url)
  )
);
const moduleList = json.buildModules.install;
const installOptions = json.buildModules.installOptions;

await install(moduleList, installOptions);

```

- Hello World

æ‰§è¡Œyarn installåï¼Œæˆ‘ä»¬ä½¿ç”¨[lit](https://lit.dev/)åœ¨main.jsä¸­åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰[Web Components](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components#%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%BF%E7%94%A8)ç»„ä»¶ï¼Œç»„ä»¶åŒ…å«äº†ä¸€ä¸ªè¾“å…¥æ¡†å’Œäº‹ä»¶ç›‘å¬å™¨ã€äº‹ä»¶å¤„ç†æ–¹æ³•ï¼›å¹¶ä½¿ç”¨[dom-confetti](https://github.com/daniel-lundin/dom-confetti)åŠ ä¸Šä¸€ç‚¹åŠ¨æ•ˆã€‚ğŸ’¥


```js
import {LitElement, html} from './vendor/lit.js';
import { confetti } from "./vendor/dom-confetti.js";

confetti(document.body, { angle: 0, duration: 10000 });

class MyElement extends LitElement {
    static properties = {
      name: {},
    };
  
    constructor() {
      super();
      this.name = 'Your name here';
    }

    changeName(event) {
        const input = event.target;
        this.name = input.value;
    }
  
    render() {
      return html`
        <p>Hello, ${this.name}</p>
        <input placeholder="Enter your name" @input=${this.changeName}
        >
      `;
    }
  }

customElements.define('my-element', MyElement);


```


- æµ‹è¯•

ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨ï¼Œè®¿é—®index.htmlï¼Œæ— éœ€æ‰“åŒ…å°±å¯ä»¥çœ‹åˆ°ç¼–å†™çš„åº”ç”¨äº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec171d01b73749c3a34c5cf265bbe604~tplv-k3u1fbpfcp-zoom-1.image)


## å½“å‰æ–¹æ¡ˆçš„å±€é™æ€§

ä»Hello Worldä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“å‰ESMæ–¹æ¡ˆè¿˜è¿œæœªæˆç†Ÿï¼Œæ— æ³•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼ŒåŸå› å¦‚ä¸‹ï¼š

- å¾ˆå¤šä¾èµ–åº“å¯¹ESMæ”¯æŒä¸ä½³ï¼Œéœ€è¦ä½¿ç”¨esinstallè¿›è¡Œè½¬æ¢
- æ²¡æœ‰æ„å»ºæ‰“åŒ…ï¼Œå¤šä¸ªå°æ–‡ä»¶ä½¿å¾—æµè§ˆå™¨è§£å‹ç¼©å¼€é”€å¢å¤§ï¼Œå¤§å‹åº”ç”¨å¯èƒ½å­˜åœ¨æ€§èƒ½é£é™©
- æ²¡æœ‰babelï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†è·¨æµè§ˆå™¨é—®é¢˜
- æ— æ³•ä½¿ç”¨ä¸æ„å»ºå·¥å…·æ·±åº¦ç»‘å®šçš„ä¸¤å¤§å‰ç«¯æ¡†æ¶ï¼ˆVueã€Reactï¼‰

## ESMçš„æœªæ¥

è™½ç„¶ESMç›®å‰è¿˜å­˜åœ¨ç§ç§é—®é¢˜ï¼Œä½†æ˜¯å‰ç«¯é¢†åŸŸéœ€è¦æ›´å¿«çš„è¿­ä»£æ—¶é—´å’Œæ›´å°‘çš„æ„å»ºæ­¥éª¤çš„è¶‹åŠ¿æ˜¯æ— å¯é˜»æŒ¡çš„ã€‚

æ¯•ç«Ÿï¼ŒTypeScriptå›¢é˜Ÿä¸ºäº†ä¸è®©ç¼–è¯‘ç±»å‹æˆä¸ºTypeScriptä»£ç åˆ°è¿è¡Œä¹‹é—´çš„å”¯ä¸€æ­¥éª¤ï¼Œå·²ç»æ±‚ç”Ÿæ¬²æ»¡æ»¡çš„æå‡ºäº†ç›´æ¥åœ¨JavaScriptä¸­æ”¯æŒç±»å‹çš„[stage0](https://github.com/giltayar/proposal-types-as-comments)ææ¡ˆã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f648de7d3bd64bb384b70de99ca4a54e~tplv-k3u1fbpfcp-zoom-1.image)

å†æ·±ä¸€å±‚æƒ³ï¼Œwebpackæ€ä¹ˆä¹Ÿä¸ä¼šæƒ³åˆ°viteç«Ÿç„¶è¿™ä¹ˆä¸å¯åŒ¹æ•Œã€‚è€Œè°ï¼Œåˆæ˜¯ä¸‹ä¸€ä¸ªviteå‘¢ï¼ŸğŸ˜‰
